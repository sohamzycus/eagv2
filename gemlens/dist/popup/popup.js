var m=Object.defineProperty;var h=(c,t,e)=>t in c?m(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var a=(c,t,e)=>h(c,typeof t!="symbol"?t+"":t,e);class y{constructor(){a(this,"currentTab",null);a(this,"statusIndicator");a(this,"statusText");a(this,"summaryContainer");a(this,"summaryContent");a(this,"historyContainer");a(this,"historyContent");this.statusIndicator=document.getElementById("statusIndicator"),this.statusText=document.getElementById("statusText"),this.summaryContainer=document.getElementById("summaryContainer"),this.summaryContent=document.getElementById("summaryContent"),this.historyContainer=document.getElementById("historyContainer"),this.historyContent=document.getElementById("historyContent"),this.init()}async init(){await this.getCurrentTab(),await this.checkApiKeyStatus(),this.setupEventListeners()}async getCurrentTab(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});this.currentTab=t}catch(t){console.error("Failed to get current tab:",t)}}async checkApiKeyStatus(){try{const t=await chrome.runtime.sendMessage({action:"checkApiKey"});t!=null&&t.hasKey?(this.updateStatus("ready","Ready to summarize"),this.enableButtons(!0)):(this.updateStatus("warning","API key required"),this.enableButtons(!1))}catch{this.updateStatus("error","Extension error"),this.enableButtons(!1)}}updateStatus(t,e){const r=this.statusIndicator.querySelector(".status-dot");r.className=`status-dot ${t==="ready"?"":t}`,this.statusText.textContent=e}enableButtons(t){document.querySelectorAll(".action-btn").forEach(r=>{r.disabled=!t})}setupEventListeners(){var t,e,r,n,s,i,o,d,u;(t=document.getElementById("summarizeBtn"))==null||t.addEventListener("click",()=>{this.summarizePage()}),(e=document.getElementById("summarizeVideoBtn"))==null||e.addEventListener("click",()=>{this.summarizeVideo()}),(r=document.getElementById("askGeminiBtn"))==null||r.addEventListener("click",()=>{this.openGeminiChat()}),(n=document.getElementById("settingsBtn"))==null||n.addEventListener("click",()=>{chrome.runtime.openOptionsPage()}),(s=document.getElementById("closeSummary"))==null||s.addEventListener("click",()=>{this.closeSummary()}),(i=document.getElementById("copyBtn"))==null||i.addEventListener("click",()=>{this.copySummary()}),(o=document.getElementById("historyBtn"))==null||o.addEventListener("click",()=>{this.showHistory()}),(d=document.getElementById("closeHistory"))==null||d.addEventListener("click",()=>{this.closeHistory()}),(u=document.getElementById("saveBtn"))==null||u.addEventListener("click",()=>{this.saveSummary()})}async summarizePage(){var t,e,r;if((t=this.currentTab)!=null&&t.id)try{this.showLoading("Extracting page content...");const[n]=await chrome.scripting.executeScript({target:{tabId:this.currentTab.id},func:()=>new Promise(o=>{chrome.runtime.sendMessage({action:"extractContent"},d=>{o(d)})})});if(!((e=n==null?void 0:n.result)!=null&&e.success))throw new Error("Failed to extract page content");const s=n.result.content;this.showLoading("Generating summary...");const i=await chrome.runtime.sendMessage({action:"summarizePage",text:s.text,url:s.url,title:s.title||((r=this.currentTab)==null?void 0:r.title)||"Untitled Page",type:s.type||"webpage"});if(i!=null&&i.error)throw new Error(i.error);this.showSummary(i.summary)}catch(n){this.showError("Failed to summarize page: "+n.message)}}async summarizeVideo(){var t,e,r;if((t=this.currentTab)!=null&&t.id)try{if(this.showLoading("Extracting video content..."),!((e=this.currentTab.url)!=null&&e.includes("youtube.com")))throw new Error("Video summarization currently supports YouTube only");const[n]=await chrome.scripting.executeScript({target:{tabId:this.currentTab.id},func:()=>new Promise(d=>{chrome.runtime.sendMessage({action:"extractContent"},u=>{d(u)})})});if(!((r=n==null?void 0:n.result)!=null&&r.success))throw new Error("Failed to extract video content");const s=n.result.content;if(s.type!=="video")throw new Error("No video content detected on this page");this.showLoading("Generating video summary...");const i=s.captions||s.text,o=await chrome.runtime.sendMessage({action:"summarizePage",text:`Video content: ${i}`,url:s.url});if(o!=null&&o.error)throw new Error(o.error);this.showSummary(o.summary)}catch(n){this.showError("Failed to summarize video: "+n.message)}}async openGeminiChat(){var t;if((t=this.currentTab)!=null&&t.id)try{await chrome.scripting.executeScript({target:{tabId:this.currentTab.id},func:()=>{chrome.runtime.sendMessage({action:"showOverlay"})}}),window.close()}catch(e){this.showError("Failed to open chat: "+e.message)}}showLoading(t){this.updateStatus("ready",t),this.enableButtons(!1);const e=document.querySelector(".action-btn:not(:disabled)");e&&e.classList.add("loading")}showSummary(t){this.summaryContent.textContent=t,this.summaryContainer.style.display="block",this.updateStatus("ready","Summary generated"),this.enableButtons(!0),document.querySelectorAll(".action-btn").forEach(e=>{e.classList.remove("loading")})}showError(t){this.updateStatus("error",t),this.enableButtons(!0),document.querySelectorAll(".action-btn").forEach(e=>{e.classList.remove("loading")})}closeSummary(){this.summaryContainer.style.display="none"}async copySummary(){try{await navigator.clipboard.writeText(this.summaryContent.textContent||"");const t=document.getElementById("copyBtn"),e=t.textContent;t.textContent="Copied!",t.style.background="#34C759",setTimeout(()=>{t.textContent=e,t.style.background="#007AFF"},1e3)}catch(t){console.error("Failed to copy summary:",t)}}async showHistory(){try{this.historyContainer.style.display="block",this.historyContent.innerHTML='<div class="loading">Loading history...</div>';const t=await chrome.runtime.sendMessage({action:"getHistory"});t!=null&&t.history&&t.history.length>0?this.displayHistory(t.history):this.historyContent.innerHTML='<div style="padding: 20px; text-align: center; color: #666;">No summaries yet</div>'}catch{this.historyContent.innerHTML='<div style="padding: 20px; text-align: center; color: #ff3b30;">Failed to load history</div>'}}displayHistory(t){this.historyContent.innerHTML="",t.forEach((e,r)=>{const n=document.createElement("div");n.className="history-item";const s=new Date(e.timestamp).toLocaleDateString(),i=e.summary.substring(0,100)+(e.summary.length>100?"...":"");n.innerHTML=`
        <div class="history-item-title">${e.title}</div>
        <div class="history-item-url">${e.url}</div>
        <div class="history-item-preview">${i}</div>
        <div class="history-item-date">${s}</div>
      `,n.addEventListener("click",()=>{this.showHistoryItem(e)}),this.historyContent.appendChild(n)})}showHistoryItem(t){this.summaryContent.textContent=t.summary,this.summaryContainer.style.display="block",this.historyContainer.style.display="none"}closeHistory(){this.historyContainer.style.display="none"}async saveSummary(){const t=document.getElementById("saveBtn"),e=t.textContent;t.textContent="Saved!",t.style.background="#34C759",setTimeout(()=>{t.textContent=e,t.style.background="#34C759"},1e3)}}document.addEventListener("DOMContentLoaded",()=>{new y});
