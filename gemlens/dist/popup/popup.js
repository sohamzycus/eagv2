var d=Object.defineProperty;var h=(o,t,e)=>t in o?d(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var c=(o,t,e)=>h(o,typeof t!="symbol"?t+"":t,e);class l{constructor(){c(this,"currentTab",null);c(this,"statusIndicator");c(this,"statusText");c(this,"summaryContainer");c(this,"summaryContent");this.statusIndicator=document.getElementById("statusIndicator"),this.statusText=document.getElementById("statusText"),this.summaryContainer=document.getElementById("summaryContainer"),this.summaryContent=document.getElementById("summaryContent"),this.init()}async init(){await this.getCurrentTab(),await this.checkApiKeyStatus(),this.setupEventListeners()}async getCurrentTab(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});this.currentTab=t}catch(t){console.error("Failed to get current tab:",t)}}async checkApiKeyStatus(){try{const t=await chrome.runtime.sendMessage({action:"checkApiKey"});t!=null&&t.hasKey?(this.updateStatus("ready","Ready to summarize"),this.enableButtons(!0)):(this.updateStatus("warning","API key required"),this.enableButtons(!1))}catch{this.updateStatus("error","Extension error"),this.enableButtons(!1)}}updateStatus(t,e){const r=this.statusIndicator.querySelector(".status-dot");r.className=`status-dot ${t==="ready"?"":t}`,this.statusText.textContent=e}enableButtons(t){document.querySelectorAll(".action-btn").forEach(r=>{r.disabled=!t})}setupEventListeners(){var t,e,r,s,n,i;(t=document.getElementById("summarizeBtn"))==null||t.addEventListener("click",()=>{this.summarizePage()}),(e=document.getElementById("summarizeVideoBtn"))==null||e.addEventListener("click",()=>{this.summarizeVideo()}),(r=document.getElementById("askGeminiBtn"))==null||r.addEventListener("click",()=>{this.openGeminiChat()}),(s=document.getElementById("settingsBtn"))==null||s.addEventListener("click",()=>{chrome.runtime.openOptionsPage()}),(n=document.getElementById("closeSummary"))==null||n.addEventListener("click",()=>{this.closeSummary()}),(i=document.getElementById("copyBtn"))==null||i.addEventListener("click",()=>{this.copySummary()})}async summarizePage(){var t,e;if((t=this.currentTab)!=null&&t.id)try{this.showLoading("Extracting page content...");const[r]=await chrome.scripting.executeScript({target:{tabId:this.currentTab.id},func:()=>new Promise(i=>{chrome.runtime.sendMessage({action:"extractContent"},a=>{i(a)})})});if(!((e=r==null?void 0:r.result)!=null&&e.success))throw new Error("Failed to extract page content");const s=r.result.content;this.showLoading("Generating summary...");const n=await chrome.runtime.sendMessage({action:"summarizePage",text:s.text,url:s.url});if(n!=null&&n.error)throw new Error(n.error);this.showSummary(n.summary)}catch(r){this.showError("Failed to summarize page: "+r.message)}}async summarizeVideo(){var t,e,r;if((t=this.currentTab)!=null&&t.id)try{if(this.showLoading("Extracting video content..."),!((e=this.currentTab.url)!=null&&e.includes("youtube.com")))throw new Error("Video summarization currently supports YouTube only");const[s]=await chrome.scripting.executeScript({target:{tabId:this.currentTab.id},func:()=>new Promise(u=>{chrome.runtime.sendMessage({action:"extractContent"},m=>{u(m)})})});if(!((r=s==null?void 0:s.result)!=null&&r.success))throw new Error("Failed to extract video content");const n=s.result.content;if(n.type!=="video")throw new Error("No video content detected on this page");this.showLoading("Generating video summary...");const i=n.captions||n.text,a=await chrome.runtime.sendMessage({action:"summarizePage",text:`Video content: ${i}`,url:n.url});if(a!=null&&a.error)throw new Error(a.error);this.showSummary(a.summary)}catch(s){this.showError("Failed to summarize video: "+s.message)}}async openGeminiChat(){var t;if((t=this.currentTab)!=null&&t.id)try{await chrome.scripting.executeScript({target:{tabId:this.currentTab.id},func:()=>{chrome.runtime.sendMessage({action:"showOverlay"})}}),window.close()}catch(e){this.showError("Failed to open chat: "+e.message)}}showLoading(t){this.updateStatus("ready",t),this.enableButtons(!1);const e=document.querySelector(".action-btn:not(:disabled)");e&&e.classList.add("loading")}showSummary(t){this.summaryContent.textContent=t,this.summaryContainer.style.display="block",this.updateStatus("ready","Summary generated"),this.enableButtons(!0),document.querySelectorAll(".action-btn").forEach(e=>{e.classList.remove("loading")})}showError(t){this.updateStatus("error",t),this.enableButtons(!0),document.querySelectorAll(".action-btn").forEach(e=>{e.classList.remove("loading")})}closeSummary(){this.summaryContainer.style.display="none"}async copySummary(){try{await navigator.clipboard.writeText(this.summaryContent.textContent||"");const t=document.getElementById("copyBtn"),e=t.textContent;t.textContent="Copied!",t.style.background="#34C759",setTimeout(()=>{t.textContent=e,t.style.background="#007AFF"},1e3)}catch(t){console.error("Failed to copy summary:",t)}}}document.addEventListener("DOMContentLoaded",()=>{new l});
