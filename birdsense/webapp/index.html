<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê¶ BirdSense - Zero-Shot Bird Recognition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üê¶</span>
                <div class="logo-text">
                    <h1>BirdSense</h1>
                    <span class="tagline">Zero-Shot LLM ‚Ä¢ 10,000+ Species ‚Ä¢ India Focus</span>
                </div>
            </div>
            <div class="header-status">
                <div class="status-indicator" id="apiStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel: Input -->
            <section class="panel input-panel">
                <div class="panel-header">
                    <h2>üé§ Audio Input</h2>
                    <p>Record from field or upload samples</p>
                </div>

                <!-- Tab Navigation -->
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="record">
                        <span class="tab-icon">üéôÔ∏è</span>
                        Record Live
                    </button>
                    <button class="tab-btn" data-tab="upload">
                        <span class="tab-icon">üìÅ</span>
                        Upload File
                    </button>
                </div>

                <!-- Record Tab -->
                <div class="tab-content active" id="recordTab">
                    <!-- Live Waveform -->
                    <div class="visualizer-container">
                        <canvas id="waveformCanvas" width="600" height="120"></canvas>
                        <div class="visualizer-label">
                            <span id="recordingTime">00:00</span>
                            <span id="audioLevel">Level: --</span>
                        </div>
                    </div>

                    <!-- Recording Controls -->
                    <div class="record-controls">
                        <button class="btn btn-record" id="recordBtn">
                            <span class="btn-icon">‚è∫Ô∏è</span>
                            <span class="btn-text">Start Recording</span>
                        </button>
                        <button class="btn btn-stop" id="stopBtn" disabled>
                            <span class="btn-icon">‚èπÔ∏è</span>
                            <span class="btn-text">Stop</span>
                        </button>
                    </div>

                    <!-- Live Histogram Display -->
                    <div class="histogram-container">
                        <h3>üìä Live Frequency Histogram</h3>
                        <canvas id="histogramCanvas" width="600" height="150"></canvas>
                        <div class="histogram-legend">
                            <span class="legend-item"><span class="legend-color low"></span>Low (50-500Hz)</span>
                            <span class="legend-item"><span class="legend-color mid-low"></span>Mid-Low (0.5-2kHz)</span>
                            <span class="legend-item"><span class="legend-color mid-high"></span>Mid-High (2-5kHz)</span>
                            <span class="legend-item"><span class="legend-color high"></span>High (5-14kHz)</span>
                        </div>
                    </div>
                </div>

                <!-- Upload Tab -->
                <div class="tab-content" id="uploadTab">
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-icon">üìÇ</div>
                        <p class="upload-text">Drag & drop audio file here</p>
                        <p class="upload-subtext">or click to browse</p>
                        <p class="upload-formats">Supports: WAV, MP3, FLAC, OGG</p>
                        <input type="file" id="fileInput" accept="audio/*" hidden>
                    </div>
                    <div class="uploaded-file" id="uploadedFile" style="display: none;">
                        <span class="file-icon">üéµ</span>
                        <div class="file-info">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                        </div>
                        <button class="btn-remove" id="removeFile">‚úï</button>
                    </div>
                </div>

                <!-- Context Fields -->
                <div class="context-fields">
                    <h3>üìç Recording Context (Optional)</h3>
                    <div class="field-grid">
                        <div class="field">
                            <label for="locationName">Location</label>
                            <input type="text" id="locationName" placeholder="e.g., Western Ghats, Kerala">
                        </div>
                        <div class="field">
                            <label for="month">Month</label>
                            <select id="month">
                                <option value="">Select month</option>
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <div class="field full-width">
                            <label for="description">Notes/Description</label>
                            <textarea id="description" placeholder="Any additional observations about the bird..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Analyze Button -->
                <button class="btn btn-analyze" id="analyzeBtn" disabled>
                    <span class="btn-icon">üîç</span>
                    <span class="btn-text">Identify Bird</span>
                </button>
            </section>

            <!-- Right Panel: Results -->
            <section class="panel results-panel">
                <div class="panel-header">
                    <h2>üéØ Identification Results</h2>
                    <p>Zero-shot LLM identification (10,000+ species)</p>
                </div>

                <!-- Processing Status -->
                <div class="processing-status" id="processingStatus" style="display: none;">
                    <div class="processing-spinner"></div>
                    <div class="processing-steps">
                        <div class="step" id="step-analyzing">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-text">Analyzing audio quality...</span>
                        </div>
                        <div class="step" id="step-preprocessing">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-text">Extracting audio features...</span>
                        </div>
                        <div class="step" id="step-classifying">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-text">AI analyzing bird calls...</span>
                        </div>
                        <div class="step" id="step-reasoning">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-text">Generating reasoning...</span>
                        </div>
                    </div>
                </div>

                <!-- Results Display -->
                <div class="results-container" id="resultsContainer" style="display: none;">
                    <!-- Top Result Card -->
                    <div class="top-result" id="topResult">
                        <div class="result-badges">
                            <span class="result-badge">TOP MATCH</span>
                            <span class="confidence-badge" id="confidenceBadge">--</span>
                        </div>
                        <div class="species-name" id="topSpeciesName">--</div>
                        <div class="scientific-name" id="topScientificName">--</div>
                        <div class="confidence-meter">
                            <div class="confidence-track">
                                <div class="confidence-bar" id="topConfidenceBar"></div>
                            </div>
                            <span class="confidence-text" id="topConfidenceText">--%</span>
                        </div>
                        <div class="key-features" id="keyFeatures"></div>
                    </div>

                    <!-- Audio Quality -->
                    <div class="quality-card">
                        <h4>üìä Audio Analysis</h4>
                        <div class="quality-info">
                            <div class="quality-item">
                                <span class="quality-label">Quality</span>
                                <span class="quality-value" id="audioQuality">--</span>
                            </div>
                            <div class="quality-item">
                                <span class="quality-label">Score</span>
                                <span class="quality-value" id="qualityScore">--</span>
                            </div>
                            <div class="quality-item">
                                <span class="quality-label">Duration</span>
                                <span class="quality-value" id="audioDuration">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- All Predictions -->
                    <div class="predictions-list">
                        <h4>üê¶ All Predictions</h4>
                        <div id="predictionsList"></div>
                    </div>

                    <!-- LLM Reasoning -->
                    <div class="llm-reasoning" id="llmReasoning" style="display: none;">
                        <h4>ü§ñ AI Analysis</h4>
                        <div class="reasoning-content" id="reasoningContent"></div>
                    </div>

                    <!-- Novelty Alert -->
                    <div class="novelty-alert" id="noveltyAlert" style="display: none;">
                        <div class="novelty-icon">üåç</div>
                        <div class="novelty-content">
                            <span class="novelty-title">Unusual Sighting!</span>
                            <span class="novelty-text" id="noveltyText"></span>
                        </div>
                    </div>
                </div>

                <!-- Live Detections Stream (shown when >60% confidence) -->
                <div class="live-stream-panel" id="liveStreamPanel">
                    <h4>üî¥ Live Detection Stream</h4>
                    <p class="live-hint">Birds with ‚â•60% confidence appear here</p>
                    <div class="live-detections" id="liveDetections">
                        <div class="empty-live">No detections yet</div>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">üéµ</div>
                    <p>Record audio or upload a file to identify birds</p>
                    <p class="empty-hint">Powered by Zero-Shot LLM - No training required!</p>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-info">
                <span>üáÆüá≥ CSCR Initiative</span>
                <span>‚Ä¢</span>
                <span>Zero-Shot LLM (qwen2.5:3b)</span>
                <span>‚Ä¢</span>
                <span id="speciesCount">10,000+ species</span>
            </div>
            <div class="footer-links">
                <a href="/docs" target="_blank">API Docs</a>
                <a href="/api/v1/status" target="_blank">System Status</a>
            </div>
        </footer>
    </div>

    <!-- Audio Player (hidden) -->
    <audio id="audioPlayer" style="display: none;"></audio>

    <script src="app.js"></script>
</body>
</html>
